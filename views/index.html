<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Comunicados</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    form { margin-bottom: 20px; }
    .comunicado { background: #fff; padding: 15px; border-left: 4px solid #2196f3; margin-bottom: 10px; }
    .parte2 { margin-top: 10px; font-style: italic; }
    .erros { color: red; font-weight: bold; margin-top: 10px; }
    .resumo-erros { background: #ffeaea; padding: 10px; border: 1px solid #f00; margin-top: 30px; }
  </style>
</head>
<body>
  <h1>Processador de Comunicados</h1>
  <form id="formUpload">
    <input type="file" name="pdf" accept="application/pdf" required />
    <button type="submit">Enviar PDF</button>
  </form>
  <div id="resultados"></div>
  <div id="resumoErros"></div>
  <script>
    const form = document.getElementById('formUpload');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const response = await fetch('/upload', {
        method: 'POST',
        body: formData
      });
      const { comunicados, erros } = await response.json();
      const container = document.getElementById('resultados');
      const resumo = document.getElementById('resumoErros');
      container.innerHTML = '';
      resumo.innerHTML = '';
      comunicados.forEach(com => {
        const div = document.createElement('div');
        div.className = 'comunicado';
        div.innerHTML = `<div>${com.parte1}</div><div class="parte2">${com.parte2}</div>` +
        (com.erros.length ? `<div class="erros">‚ö†Ô∏è ${com.erros.join(', ')}</div>` : '');
        container.appendChild(div);
      });
      if (erros.length) {
        resumo.innerHTML = `<div class="resumo-erros"><strong>${erros.length} comunicado(s) com erros:</strong><br>` +
          erros.map(e => `üì¶ COMUNICADO ${e.id}: ${e.erros.join(', ')}`).join('<br>') +
          `</div>`;
      }
    });
  </script>
</body>
</html>